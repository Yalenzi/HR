<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h1>
    
    <div class="test-section">
        <h3>1. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</h3>
        <button onclick="testConnection()">Ø§Ø®ØªØ¨Ø§Ø± GET</button>
        <button onclick="testPost()">Ø§Ø®ØªØ¨Ø§Ø± POST</button>
        <div id="connectionResult"></div>
    </div>
    
    <div class="test-section">
        <h3>2. Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø©</h3>
        <button onclick="testCardGeneration()">Ø¥Ù†Ø´Ø§Ø¡ Ø¨Ø·Ø§Ù‚Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        <div id="cardResult"></div>
    </div>
    
    <div class="test-section">
        <h3>3. Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <button onclick="getSystemInfo()">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù…</button>
        <div id="systemInfo"></div>
    </div>

    <script>
        function showResult(elementId, content, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<pre class="${isSuccess ? 'success' : 'error'}">${content}</pre>`;
        }

        async function testConnection() {
            try {
                const response = await fetch('generate.php', {
                    method: 'GET'
                });
                const result = await response.text();
                showResult('connectionResult', `GET Response:\n${result}`, response.ok);
            } catch (error) {
                showResult('connectionResult', `GET Error:\n${error.message}`, false);
            }
        }

        async function testPost() {
            try {
                const testData = {
                    line1: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    line2: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    line3: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    employeeName: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    department: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    position: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    organization: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    startDate: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    endDate: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    location: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    signature: 'Ø§Ø®ØªØ¨Ø§Ø±',
                    template: 'template1'
                };

                const response = await fetch('generate.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.text();
                showResult('connectionResult', `POST Response:\n${result}`, response.ok);
            } catch (error) {
                showResult('connectionResult', `POST Error:\n${error.message}`, false);
            }
        }

        async function testCardGeneration() {
            try {
                const testData = {
                    line1: 'Ø¨ÙƒÙ„ Ø§Ù„Ø­Ø¨ ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±',
                    line2: 'Ø£ØªØ´Ø±Ù Ø¨Ø¥Ø¹Ù„Ø§Ù…ÙƒÙ…',
                    line3: 'Ø¨ØªÙ…Ø¯ÙŠØ¯ ØªÙƒÙ„ÙŠÙÙŠ ÙÙŠ Ù…Ù†ØµØ¨ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ',
                    employeeName: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù„ÙŠ',
                    department: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©',
                    position: 'Ù…Ø¯ÙŠØ± Ø¥Ø¯Ø§Ø±Ø©',
                    organization: 'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…',
                    startDate: 'Ø§Ù„Ù…ÙˆØ§ÙÙ‚ Ù¡Ù¤Ù¤Ù¥/Ù Ù£/Ù¡Ù¥ Ù‡Ù€',
                    endDate: 'Ø­ØªÙ‰ ØªØ§Ø±ÙŠØ® Ù¡Ù¤Ù¤Ù¦/Ù Ù£/Ù¡Ù¥ Ù‡Ù€',
                    location: 'Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©',
                    signature: 'Ù…Ø¹ Ø£Ø·ÙŠØ¨ Ø§Ù„ØªØ­ÙŠØ§Øª',
                    template: 'template1'
                };

                const response = await fetch('generate.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.text();
                showResult('cardResult', `Card Generation Response:\n${result}`, response.ok);
                
                // Ø¥Ø°Ø§ Ù†Ø¬Ø­ØŒ Ø­Ø§ÙˆÙ„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                if (response.ok) {
                    try {
                        const jsonResult = JSON.parse(result);
                        if (jsonResult.success && jsonResult.file_url) {
                            const link = document.createElement('a');
                            link.href = jsonResult.file_url;
                            link.download = jsonResult.filename;
                            link.click();
                        }
                    } catch (e) {
                        console.log('Could not parse JSON or download file');
                    }
                }
            } catch (error) {
                showResult('cardResult', `Card Generation Error:\n${error.message}`, false);
            }
        }

        async function getSystemInfo() {
            try {
                const response = await fetch('generate.php?info=1', {
                    method: 'GET'
                });
                const result = await response.text();
                showResult('systemInfo', `System Info:\n${result}`, response.ok);
            } catch (error) {
                showResult('systemInfo', `System Info Error:\n${error.message}`, false);
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            testConnection();
        };
    </script>
</body>
</html>
